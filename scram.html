<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>SJ zxs</title>
  <style>
    /* Darker pastel green palette with richer animations (CSS-only) */
    :root {
      --bg: #0e1b14;              /* darker pastel green background */
      --secondary-bg: #1a2f25;
      --third-bg: #244f36;
      --fourth-bg: #1a3a2a;
      --primary: #69c27a;
      --secondary: #58b075;
      --text-color: #e6f7ea;       /* light text on dark bg for readability */
      --secondary-text-color: #d2f0d0;
      --button-bg: #254e38;
      --button-hover: #315c45;
      --gradient-start: #2b6f4a;
      --gradient-end: #1a3d2a;
    }

    /* Global / base */
    html, body {
      height: 100%;
      width: 100%;
      margin: 0;
      padding: 0;
      font-family: "Inter", system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
      color: var(--text-color);
      /* smooth gradient background with gentle animation */
      background: linear-gradient(135deg, var(--bg) 0%, var(--secondary-bg) 40%, var(--third-bg) 100%);
      background-size: 200% 200%;
      animation: gradientShift 30s ease infinite;
      overflow: hidden;
    }

    @keyframes gradientShift {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }

    /* Scrollbar aesthetics */
    ::-webkit-scrollbar { width: 6px; height: 6px; }
    ::-webkit-scrollbar-track { background: transparent; }
    ::-webkit-scrollbar-thumb { border-radius: 6px; background: var(--fourth-bg); transition: 0.3s; }
    ::-webkit-scrollbar-thumb:hover { background: var(--third-bg); }

    /* Layout: single frame view (no tabs) */
    .browser-container {
      height: 100vh;
      width: 100vw;
      display: flex;
      flex-direction: column;
      padding: 0;
      box-sizing: border-box;
    }

    /* Top navigation row (erasable bottom space by layout) */
    .nav {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.6rem 0.8rem;
      height: 58px;
      box-sizing: border-box;
      background: rgba(0,0,0,0.08); /* subtle separation from content */
    }

    .nav button {
      color: var(--text-color);
      background: var(--button-bg);
      border: none;
      border-radius: 8px;
      padding: 0.6rem 1rem;
      cursor: pointer;
      font-size: 1.05rem;
      transition: transform 0.2s ease, background 0.2s ease;
      min-width: 44px;
      height: 40px;
    }
    .nav button:hover { background: var(--button-hover); transform: translateY(-1px); }

    .bar {
      flex: 1;
      min-width: 0;
      height: 40px;
      padding: 0.6rem 1rem;
      border-radius: 8px;
      border: none;
      outline: none;
      background: var(--button-bg);
      color: var(--text-color);
      font-size: 1.0rem;
    }
    .bar:focus { background: var(--button-hover); }

    /* Iframe region fills the rest of the screen */
    .iframe-container {
      position: relative;
      flex: 1 1 auto;
      min-height: 0;
      /* Ensure the container doesn't create extra bottom space */
    }

    .iframe-container iframe {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      border: none;
      border-radius: 12px;
      background: #fff;
      /* subtle entrance animation for the embedded page */
      animation: fadeIn 0.5s ease both;
    }

    @keyframes fadeIn { from { opacity: 0; transform: translateY(6px); } to { opacity: 1; transform: translateY(0); } }

    /* Minor accessibility/UX extras */
    :focus-visible {
      outline: 3px solid var(--secondary);
      outline-offset: 2px;
      border-radius: 6px;
    }
    button:focus-visible,
    .bar:focus-visible {
      outline: 3px solid var(--secondary);
      outline-offset: 2px;
      border-radius: 6px;
    }

    /* Remove any theming remnants if present (themes disabled) */
    #themeStylesheet, link#themeStylesheet { display: none !important; }
  </style>
</head>

<body>
  <div id="app"></div>

  <script src="https://cdn.jsdelivr.net/npm/dreamland"></script>
  <script src="/baremux/index.js"></script>
  <script src="/scram/scramjet.all.js"></script>
  <script src="/scram/scramjet.wasm.wasm"></script>
  <script src="/assets/config.js"></script>

  <script>
    // Initialize Scramjet (no tabs)
    const { ScramjetController } = $scramjetLoadController();

    const scramjet = new ScramjetController({
      files: {
        wasm: "/scram/scramjet.wasm.wasm",
        all: "/scram/scramjet.all.js",
        sync: "/scram/scramjet.sync.js",
      },
    });

    scramjet.init();
    // Service worker (as before)
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register("./sw.js").catch(() => {});
    }

    // BareMux connection (unchanged)
    const connection = new BareMux.BareMuxConnection("/baremux/worker.js");

    const store = {
      url: "https://",
      wispurl: localStorage.getItem("proxServer") || "wss://wisp.mercurywork.shop/wisp/",
      bareurl:
        _CONFIG?.bareurl ||
        (location.protocol === "https:" ? "https" : "http") +
        "://" +
        location.host +
        "/bare/",
      proxy: "",
    };

    connection.setTransport("/epoxy/index.mjs", [{ wisp: store.wispurl }]);

    // Single-frame state
    let singleFrame = null;

    function createSingleFrame() {
      singleFrame = scramjet.createFrame();
      // Start with a friendly landing page
      singleFrame.frame.src = "/assets/pages/newtab.html";

      // Update address bar when URL changes
      singleFrame.addEventListener("urlchange", (e) => {
        if (!e.url) return;
        const addressBar = document.getElementById("address-bar");
        if (addressBar) addressBar.value = e.url;

        // Update window title for context
        try {
          const title = singleFrame.frame.contentWindow?.document?.title || new URL(e.url).hostname;
          document.title = title || "Vapor scramjet";
        } catch {
          document.title = new URL(e.url).hostname || "Vapor scramjet";
        }
      });
    }

    window.addEventListener("load", async () => {
      const root = document.getElementById("app");

      // Minimal UI: nav + address bar + single embed
      root.innerHTML = `
        <div class="browser-container">
          <div class="nav">
            <button onclick="window.__CURRENT_FRAME?.back()">&larr;</button>
            <button onclick="window.__CURRENT_FRAME?.forward()">&rarr;</button>
            <button onclick="window.__CURRENT_FRAME?.reload()">‚ü≤</button>
            <input class="bar" id="address-bar" autocomplete="off" autocapitalize="off" autocorrect="off"
              onkeyup="event.keyCode === 13 && handleSubmit()"
              placeholder="Enter URL or search"/>
          </div>
          <div class="iframe-container" id="iframe-container"></div>
        </div>
      `;

      // Create and mount the single frame
      createSingleFrame();
      const container = document.getElementById("iframe-container");
      if (singleFrame?.frame) {
        container.appendChild(singleFrame.frame);
        // expose to global for inline onclicks
        window.__CURRENT_FRAME = singleFrame;
      }

      // Optional initial navigation hint
      try {
        // Prefetch or set up if needed
      } catch (e) {
        // ignore
      }
    });

    // Navigate using the single frame
    function handleSubmit() {
      if (!singleFrame || !singleFrame.go) return;
      const addressBar = document.getElementById("address-bar");
      if (!addressBar) return;

      let url = addressBar.value.trim();

      if (!url.startsWith("http") && !url.includes(".")) {
        url = "https://duckduckgo.com/?q=" + encodeURIComponent(url);
      } else if (!url.startsWith("http")) {
        url = "https://" + url;
      }

      // Navigate the single frame
      singleFrame.go(url);
      addressBar.value = url;
    }
  </script>
</body>
</html>
