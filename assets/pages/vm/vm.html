<!DOCTYPE html>
<html lang="en">
<head>
  <script src="../../js/panic-core.js" defer></script>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>VM SB</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      background-color: #000;
      color: #0f0;
      font-family: 'Consolas', monospace;
      overflow: hidden;
      display: flex;
      flex-direction: column;
    }

    .selector-bar {
      width: 100%;
      background-color: #000;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      transition: height 0.5s ease, padding 0.5s ease;
      border-bottom: 1px solid #0f0;
      z-index: 10;
    }

    .selector-bar.fullscreen {
      height: 100%;
      padding-top: 15vh;
      gap: 20px;
    }

    .selector-bar.shrunk {
      height: 60px;
      flex-direction: row;
      justify-content: center;
      padding: 0;
      gap: 20px;
    }

    h2 {
      font-size: 2rem;
      text-shadow: 0 0 5px #0f0;
      margin: 0;
      transition: font-size 0.3s ease;
    }

    .selector-bar.shrunk h2 {
      font-size: 1rem;
    }

    .vm-buttons {
      display: flex;
      gap: 20px;
      flex-wrap: wrap;
    }

    .selector-bar.shrunk .vm-buttons {
      gap: 10px;
    }

    button {
      background-color: #000;
      color: #0f0;
      border: 2px solid #0f0;
      padding: 12px 30px;
      font-size: 1.2rem;
      cursor: pointer;
      transition: all 0.3s ease;
      text-shadow: 0 0 3px #0f0;
    }

    .selector-bar.shrunk button {
      padding: 4px 10px;
      font-size: 0.8rem;
    }

    button:hover {
      background-color: #0f0;
      color: #000;
      text-shadow: none;
    }

    iframe {
      flex: 1;
      width: 100%;
      border: none;
      background-color: #111;
    }

    @keyframes flicker {
      0% { opacity: 1; }
      5% { opacity: 0.8; }
      10% { opacity: 1; }
      15% { opacity: 0.9; }
      20% { opacity: 1; }
      100% { opacity: 1; }
    }

    h2, button {
      animation: flicker 2s infinite alternate;
    }
  </style>
</head>
<body>

  <div class="selector-bar fullscreen" id="selector">
    <h2>Select Your VM</h2>
    <div class="vm-buttons">
      <button id="chromeBtn" aria-label="Select Chrome VM">Chrome VM</button>
      <button id="androidBtn" aria-label="Select Android VM">Android VM</button>
    </div>
  </div>

  <iframe id="vmFrame" src="" title="VM Display Frame" aria-live="polite"></iframe>

<script>
  const selector = document.getElementById('selector');
  const vmFrame  = document.getElementById('vmFrame');
  const chromeBtn = document.getElementById('chromeBtn');
  const androidBtn = document.getElementById('androidBtn');

  function shrinkSelector() {
    selector.classList.remove('fullscreen');
    selector.classList.add('shrunk');
  }

  // Optional: give the iframe permissions Appetize may use
  function setAppetizePermissions() {
    vmFrame.setAttribute('allow',
      'autoplay; clipboard-read; clipboard-write; geolocation; microphone; camera; fullscreen');
    vmFrame.setAttribute('allowfullscreen', 'true');
  }

  chromeBtn.addEventListener('click', () => {
    shrinkSelector();
    // vm.html is in assets/pages/vm/ → chrome.html is the same folder
    vmFrame.src = './chrome.html'; // (or just 'chrome.html')
  });

  androidBtn.addEventListener('click', () => {
    shrinkSelector();
    setAppetizePermissions();
    // ❌ was: '../../../s/embed.html#https://appetize.io/embed/<key>'
    // ✅ use Appetize directly (replace YOUR_PUBLIC_KEY and params as needed)
    vmFrame.src = 'https://appetize.io/embed/YOUR_PUBLIC_KEY'
      + '?device=pixel7&osVersion=13.0&scale=75&autoplay=true&orientation=portrait';
  });
</script>

</body>
</html>
